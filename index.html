<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INTERPARK SIM</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont;
  background:#f5f7fa;
  text-align:center;
}
h1{color:#1a4cff;margin:40px 0 20px;}
.hidden{display:none}

button{
  border:none;
  border-radius:8px;
  font-size:16px;
}

.primary{
  width:90%;
  max-width:360px;
  padding:16px;
  background:#1a4cff;
  color:white;
}

.sub{
  width:90%;
  max-width:360px;
  padding:14px;
  background:#ddd;
  margin-top:10px;
}

#startScreen{margin-top:60px}
#count{font-size:36px;margin-bottom:20px}

.grid{
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:6px;
  max-width:330px;
  margin:20px auto;
}

.zone-floor{background:#8fd3ff}
.zone-1{background:#1a4cff;color:white}
.zone-2{background:#ff8fcf}

.seat-grid{
  display:grid;
  grid-template-columns:repeat(10,1fr);
  gap:4px;
  max-width:320px;
  margin:20px auto;
}

.seat{
  width:100%;
  aspect-ratio:1/1;
  border-radius:4px;
  background:#bbb;
}

.seat.ok{background:#7CFC98}
.seat.block{background:#999}

.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  max-width:320px;
  margin:20px auto;
}

.day{
  padding:12px 0;
  background:#eee;
  border-radius:6px;
}
.day.active{background:#1a4cff;color:white}
</style>
</head>

<body>

<h1>INTERPARK</h1>

<!-- ì‹œì‘ í™”ë©´ -->
<div id="startScreen">
  <div id="count">5</div>
  <button id="startBtn" class="primary" disabled>ì‹œì‘í•˜ê¸°</button><br>
  <button class="sub" onclick="showRanking()">ë­í‚¹ë³´ê¸°</button>
</div>

<div id="main" class="hidden"></div>

<script>
const main = document.getElementById("main");
const startBtn = document.getElementById("startBtn");
const countEl = document.getElementById("count");

let clickTime, waitNum;
let seatTryCount = 0;

// âœ… íƒ€ì´ë¨¸ (5 â†’ 1)
let t = 5;
countEl.innerText = t;

const timer = setInterval(()=>{
  t--;
  if(t > 0){
    countEl.innerText = t;
  }else{
    clearInterval(timer);
    countEl.innerText = "ì‹œì‘!";
    startBtn.disabled = false; // âœ… ì—¬ê¸°ì„œë§Œ í™œì„±í™”
  }
},1000);

// âœ… ì‹œì‘í•˜ê¸° í´ë¦­ â†’ ëŒ€ê¸°ì°½
startBtn.onclick = ()=>{
  if(startBtn.disabled) return;
  clickTime = Date.now();
  waitNum = calcWait();
  document.getElementById("startScreen").classList.add("hidden");
  main.classList.remove("hidden");
  showWaiting();
};

// ëŒ€ê¸° ìˆœë²ˆ ê³„ì‚°
function calcWait(){
  const delay = Math.random();
  if(delay < 0.3) return rand(7000,9000);
  if(delay < 0.6) return rand(10000,20000);
  if(delay < 0.85) return rand(30000,40000);
  return rand(45000,50000);
}
function rand(a,b){return Math.floor(Math.random()*(b-a))+a}

// ëŒ€ê¸° í™”ë©´
function showWaiting(){
  main.innerHTML=`
    <h2>ëŒ€ê¸° ìˆœë²ˆ</h2>
    <div>5ë§Œ ëª… ì¤‘ <b>${waitNum}ë²ˆì§¸</b></div><br>
    <button class="primary" onclick="showCalendar()">ì…ì¥í•˜ê¸°</button>
  `;
}

// ë‚ ì§œ ì„ íƒ (ë‹¬ë ¥ ëŠë‚Œ)
function showCalendar(){
  main.innerHTML=`
    <h2>2ì›”</h2>
    <div class="calendar">
      <div class="day active" onclick="showTime('2ì›” 27ì¼')">27</div>
      <div class="day active" onclick="showTime('2ì›” 28ì¼')">28</div>
    </div>
    <button class="sub" onclick="showCalendarMarch()">â–¶ 3ì›”</button><br>
    <button class="sub" onclick="showWaiting()">ë’¤ë¡œê°€ê¸°</button>
  `;
}

function showCalendarMarch(){
  main.innerHTML=`
    <h2>3ì›”</h2>
    <div class="calendar">
      <div class="day active" onclick="showTime('3ì›” 1ì¼')">1</div>
    </div>
    <button class="sub" onclick="showCalendar()">â—€ 2ì›”</button><br>
    <button class="sub" onclick="showWaiting()">ë’¤ë¡œê°€ê¸°</button>
  `;
}

// ì‹œê°„ ì„ íƒ
function showTime(date){
  main.innerHTML=`
    <h2>${date}</h2>
    <button class="primary" onclick="showCaptcha()">ê³µì—° ì˜ˆë§¤</button><br>
    <button class="sub" onclick="showCalendar()">ë’¤ë¡œê°€ê¸°</button>
  `;
}

// ë³´ì•ˆì½”ë“œ
function showCaptcha(){
  const code=[...Array(6)].map(()=>String.fromCharCode(65+Math.random()*26|0)).join("");
  window.cap = code;
  main.innerHTML=`
    <h2>ë³´ì•ˆì½”ë“œ ì…ë ¥</h2>
    <div>${code}</div><br>
    <input id="capInput" maxlength="6"
      oninput="this.value=this.value.toUpperCase()"><br><br>
    <button class="primary" onclick="checkCap()">í™•ì¸</button><br>
    <button class="sub" onclick="showCalendar()">ë’¤ë¡œê°€ê¸°</button>
  `;
}

function checkCap(){
  if(document.getElementById("capInput").value === cap){
    showZone();
  }
}

// êµ¬ì—­ ì„ íƒ
function showZone(){
  main.innerHTML=`
    <h2>êµ¬ì—­ ì„ íƒ</h2>
    <div class="grid">
      <button class="zone-floor" onclick="showSeat('F')">FLOOR</button>
      <button class="zone-1" onclick="showSeat('1')">1ì¸µ</button>
      <button class="zone-2" onclick="showSeat('2')">2ì¸µ</button>
    </div>
    <button class="sub" onclick="showCaptcha()">ë’¤ë¡œê°€ê¸°</button>
  `;
}

// ì¢Œì„ ì„ íƒ
function showSeat(type){
  seatTryCount = 0; // ì¢Œì„ ë“¤ì–´ì˜¬ ë•Œ ì´ˆê¸°í™”
  let total, open, rate;
  if(type==="F"){total=30;open=3;rate=0.0005}
  if(type==="1"){total=45;open=13;rate=0.03}
  if(type==="2"){total=60;open=35;rate=0.05}

  const openSet=new Set();
  while(openSet.size<open) openSet.add(rand(0,total));

  let html='<h2>ì¢Œì„ ì„ íƒ</h2><div class="seat-grid">';
  for(let i=0;i<total;i++){
    if(openSet.has(i)){
      html+=`<div class="seat ok" onclick="trySeat(this,${rate},'${type}')"></div>`;
    }else{
      html+=`<div class="seat block"></div>`;
    }
  }
  html+=`</div><button class="sub" onclick="showZone()">ë’¤ë¡œê°€ê¸°</button>`;
  main.innerHTML=html;
}

// ì¢Œì„ í´ë¦­ ì‹œë„
function trySeat(el,rate,type){
  seatTryCount++; // âœ… ì¢Œì„ í´ë¦­ íšŸìˆ˜
  if(Math.random() < rate){
    success(type);
  }else{
    el.className="seat block";
  }
}

// ì„±ê³µ
function success(type){
  const time=((Date.now()-clickTime)/1000).toFixed(2);
  saveRank(time,waitNum,type,seatTryCount);
  main.innerHTML=`
    <h2>ğŸ‰ ì˜ˆë§¤ ì„±ê³µ</h2>
    <div>${time}ì´ˆ / ${waitNum}ë²ˆ</div>
    <div>${type}êµ¬ì—­ / ì¢Œì„ ì‹œë„ ${seatTryCount}íšŒ</div><br>
    <button class="primary" onclick="showRanking()">ë­í‚¹ ë³´ê¸°</button><br>
    <button class="sub" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button>
  `;
}

// ë­í‚¹
function saveRank(t,w,z,c){
  const r=JSON.parse(localStorage.getItem("rank")||"[]");
  r.push({t,w,z,c});
  localStorage.setItem("rank",JSON.stringify(r));
}

function showRanking(){
  const r=JSON.parse(localStorage.getItem("rank")||"[]");
  let h='<h2>ğŸ† ë­í‚¹</h2>';
  r.sort((a,b)=>a.t-b.t).forEach(v=>{
    h+=`<div>${v.t}s / ${v.w}ë²ˆ / ${v.z} / ì¢Œì„ ${v.c}íšŒ</div>`;
  });
  h+='<br><button class="sub" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button>';
  document.getElementById("startScreen").classList.add("hidden");
  main.classList.remove("hidden");
  main.innerHTML=h;
}
</script>
</body>
</html>