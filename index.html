<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INTERPARK PRACTICE</title>

<style>
body{
  margin:0;
  font-family:-apple-system;
  background:#f4f6fa;
}
#app{
  max-width:420px;
  margin:auto;
  height:100vh;
  display:flex;
  flex-direction:column;
}
h1{
  text-align:center;
  color:#0066cc;
  margin:12px 0 8px;
}
#screen{
  flex:1;
  padding:14px;
}

.card{
  background:#fff;
  border-radius:12px;
  padding:18px;
  text-align:center;
}

.btn-area{
  margin-top:14px;
}

button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:8px;
  background:#0066cc;
  color:#fff;
  font-size:15px;
  margin-top:6px;
}

/* ë‹¬ë ¥ */
.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  margin-top:12px;
}
.day{
  padding:10px 0;
  border-radius:6px;
  background:#e9ecef;
}
.active{background:#0066cc;color:#fff}
.disabled{background:#ccc;color:#777}

/* êµ¬ì—­ */
.zone-grid{
  display:grid;
  grid-template-columns:repeat(12,1fr);
  gap:5px;
}
.zone{
  padding:10px 0;
  font-size:12px;
  font-weight:700;
  border-radius:6px;
  text-align:center;
}
.floor{background:#ff6b6b}
.one{background:#ffd43b}
.two{background:#69db7c}

/* ì¢Œì„ */
.seat-wrap{
  margin-top:10px;
  height:40vh;
  overflow:auto;
  background:#fff;
  border-radius:12px;
  padding:6px;
}
.seats{
  display:grid;
  grid-template-columns:repeat(24,1fr);
  gap:2px;
}
.seat{
  height:6px;
  border-radius:1px;
}
.free{background:#2db400}
</style>
</head>

<body>
<div id="app">
  <h1>INTERPARK</h1>
  <div id="screen"></div>
</div>

<script>
const screen = document.getElementById("screen");

let startTime = 0;
let enterTime = 0;
let rank = 0;
let zoneType = "";
let failStack = 0;

/* ì‹œì‘ í™”ë©´ */
function start(){
  startTime = 0;
  enterTime = 0;
  failStack = 0;

  screen.innerHTML = `
    <div class="card">
      <p>í‹°ì¼“ ì˜ˆë§¤ ì—°ìŠµ</p>
      <div class="btn-area">
        <button onclick="count()">ì‹œì‘í•˜ê¸°</button>
        <button onclick="showRanking()">ë­í‚¹ ë³´ê¸°</button>
      </div>
    </div>
  `;
}

/* 5ì´ˆ ì¹´ìš´íŠ¸ */
function count(){
  let c = 5;
  screen.innerHTML = `
    <div class="card">
      <h2 id="count">${c}</h2>
      <div class="btn-area">
        <button onclick="enter()">ì‹œì‘í•˜ê¸°</button>
      </div>
    </div>
  `;
  const t = setInterval(()=>{
    c--;
    document.getElementById("count").innerText = c;
    if(c === 0){
      startTime = performance.now();
      clearInterval(t);
    }
  },1000);
}

/* ëŒ€ê¸° ìˆœë²ˆ */
function enter(){
  if(startTime === 0 || enterTime) return;

  enterTime = performance.now();
  const diff = enterTime - startTime;
  rank = Math.min(50000, Math.floor(6500 + diff * 18));

  screen.innerHTML = `
    <div class="card">
      <p>ë‚˜ì˜ ëŒ€ê¸°ìˆœë²ˆ</p>
      <h2>${rank}ë²ˆ</h2>
    </div>
  `;

  setTimeout(calendar, 5000);
}

/* ë‹¬ë ¥ (í•­ìƒ 2ì›” + ì²« ê³µì—°) */
function calendar(){
  screen.innerHTML = `
    <div class="card">
      <h3>2026ë…„ 2ì›”</h3>
      <div class="calendar">
        ${Array.from({length:28},(_,i)=>{
          const d=i+1;
          return (d===27||d===28)
            ? `<div class="day active" onclick="captcha('${d}')">${d}</div>`
            : `<div class="day disabled">${d}</div>`;
        }).join("")}
      </div>
    </div>
  `;
}

/* ë³´ì•ˆì½”ë“œ */
function captcha(day){
  const code = [...Array(6)]
    .map(()=>String.fromCharCode(65+Math.random()*26|0))
    .join("");

  screen.innerHTML = `
    <div class="card">
      <p>${day}ì¼ ê³µì—°</p>
      <h3>${code}</h3>
      <input id="cap" maxlength="6"
        oninput="this.value=this.value.toUpperCase().replace(/[^A-Z]/g,'')">
      <button onclick="check('${code}')">í™•ì¸</button>
    </div>
  `;
}

function check(c){
  if(document.getElementById("cap").value === c) zone();
  else alert("ë³´ì•ˆì½”ë“œ ì˜¤ë¥˜");
}

/* êµ¬ì—­ */
function zone(){
  const map=[
    2,2,2,1,1,'F','F',1,1,2,2,2,
    2,2,2,2,1,1,1,1,2,2,2,2
  ];
  screen.innerHTML = `
    <div class="zone-grid">
      ${map.map(z=>{
        const cls=z==='F'?'floor':z===1?'one':'two';
        return `<div class="zone ${cls}" onclick="seat('${z}')">
          ${z==='F'?'FLOOR':z+'ì¸µ'}
        </div>`;
      }).join("")}
    </div>
  `;
}

/* ì¢Œì„ */
function seat(z){
  zoneType = z;
  window.scrollTo(0,0);

  const count = z==='F'?3 : z===1?13 : 60;

  screen.innerHTML = `
    <button onclick="zone()">â† êµ¬ì—­ ì„ íƒ</button>
    <div class="seat-wrap" id="wrap">
      <div class="seats">
        ${Array.from({length:count},()=>`
          <div class="seat free" onclick="trySeat(this)"></div>
        `).join("")}
      </div>
    </div>
  `;

  document.getElementById("wrap").scrollTop = 0;
}

/* ì¢Œì„ ì‹œë„ (ê·¹ì•… ë‚œì´ë„) */
function trySeat(el){
  let base =
    zoneType==='F'?0.0005 :
    zoneType===1?0.03 : 0.05;

  const success = Math.random() < (base - failStack*0.002);
  if(!success){
    failStack++;
    el.remove();
    alert("ì´ë¯¸ ì„ íƒëœ ì¢Œì„ì…ë‹ˆë‹¤");
  }else{
    alert("ğŸ‰ ì˜ˆë§¤ ì„±ê³µ");
    start();
  }
}

/* ë­í‚¹ */
function showRanking(){
  const r = JSON.parse(localStorage.getItem("ranking")||"[]");
  screen.innerHTML = `
    <div class="card">
      <h3>ğŸ† ë­í‚¹</h3>
      ${r.length? r.map((v,i)=>`<p>${i+1}. ${v}</p>`).join("") : "<p>ê¸°ë¡ ì—†ìŒ</p>"}
      <button onclick="start()">ëŒì•„ê°€ê¸°</button>
    </div>
  `;
}

start();
</script>
</body>
</html>