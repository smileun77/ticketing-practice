<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INTERPARK SIM</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont;
  background:#f5f7fa;
  text-align:center;
}
h1{color:#1a4cff;margin:40px 0 20px;}
.hidden{display:none}

button{
  border:none;
  border-radius:8px;
  font-size:16px;
}

.primary{
  width:90%;
  max-width:360px;
  padding:16px;
  background:#1a4cff;
  color:white;
}

.sub{
  width:90%;
  max-width:360px;
  padding:14px;
  background:#ddd;
  margin-top:10px;
}

#startScreen{margin-top:60px}
#count{font-size:36px;margin-bottom:20px}

.grid{
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:6px;
  max-width:330px;
  margin:20px auto;
}

.zone-floor{background:#8fd3ff;color:#000}
.zone-1{background:#1a4cff;color:white}
.zone-2{background:#ff8fcf;color:#000}

.seat-grid{
  display:grid;
  grid-template-columns:repeat(10,1fr);
  gap:4px;
  max-width:320px;
  margin:20px auto;
}

.seat{
  width:100%;
  aspect-ratio:1/1;
  border-radius:4px;
  background:#bbb;
}

.seat.ok{background:#7CFC98}
.seat.block{background:#999}

.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  max-width:320px;
  margin:20px auto;
}

.day{
  padding:12px 0;
  background:#eee;
  border-radius:6px;
}
.day.active{background:#1a4cff;color:white}
</style>
</head>

<body>

<h1>INTERPARK</h1>

<div id="startScreen">
  <div id="count">5</div>
  <button id="startBtn" class="primary">ì‹œì‘í•˜ê¸°</button><br>
  <button class="sub" onclick="showRanking()">ë­í‚¹ë³´ê¸°</button>
</div>

<div id="main" class="hidden"></div>

<script>
let started=false, clickTime, waitNum, tryCount=0;
const main=document.getElementById("main");
const startBtn=document.getElementById("startBtn");
const countEl=document.getElementById("count");

let t=5;
const timer=setInterval(()=>{
  if(t>0){
    countEl.innerText=t;
    t--;
  }
},1000);

startBtn.onclick=()=>{
  if(started || t>=0) return;
  started=true;
  startBtn.disabled=true;
  clickTime=Date.now();
  waitNum=calcWait();
  document.getElementById("startScreen").classList.add("hidden");
  main.classList.remove("hidden");
  showWaiting();
};

function calcWait(){
  const delay=(Date.now()-clickTime)/1000;
  if(delay<0.2) return rand(7000,9000);
  if(delay<1) return rand(10000,20000);
  if(delay<2) return rand(30000,40000);
  return rand(45000,50000);
}
function rand(a,b){return Math.floor(Math.random()*(b-a))+a}

function showWaiting(){
  main.innerHTML=`
    <h2>ëŒ€ê¸° ìˆœë²ˆ</h2>
    <div>5ë§Œ ëª… ì¤‘ <b>${waitNum}ë²ˆì§¸</b></div><br>
    <button class="primary" onclick="showCalendar()">ì…ì¥í•˜ê¸°</button>
  `;
}

function showCalendar(month=2){
  main.innerHTML=`
    <h2>${month}ì›”</h2>
    <div class="calendar">
      ${[27,28].map(d=>`<div class="day active" onclick="showTime('${month}-${d}')">${d}</div>`).join("")}
    </div>
    <button class="sub" onclick="showCalendar(3)">â–¶ 3ì›”</button><br>
    <button class="sub" onclick="showWaiting()">ë’¤ë¡œê°€ê¸°</button>
  `;
}

function showTime(d){
  main.innerHTML=`
    <h2>${d}</h2>
    <button class="primary" onclick="showCaptcha()">ê³µì—° ì˜ˆë§¤</button><br>
    <button class="sub" onclick="showCalendar()">ë’¤ë¡œê°€ê¸°</button>
  `;
}

function showCaptcha(){
  const code=[...Array(6)].map(()=>String.fromCharCode(65+Math.random()*26|0)).join("");
  window.cap=code;
  main.innerHTML=`
    <h2>ë³´ì•ˆì½”ë“œ</h2>
    <div>${code}</div><br>
    <input id="capInput" maxlength="6" oninput="this.value=this.value.toUpperCase()"><br><br>
    <button class="primary" onclick="checkCap()">í™•ì¸</button><br>
    <button class="sub" onclick="showTime('ë‚ ì§œ')">ë’¤ë¡œê°€ê¸°</button>
  `;
}

function checkCap(){
  if(document.getElementById("capInput").value===cap) showZone();
}

function showZone(){
  main.innerHTML=`
    <h2>êµ¬ì—­ ì„ íƒ</h2>
    <div class="grid">
      <button class="zone-floor" onclick="showSeat('F')">FLOOR</button>
      <button class="zone-1" onclick="showSeat('1')">1ì¸µ</button>
      <button class="zone-2" onclick="showSeat('2')">2ì¸µ</button>
    </div>
    <button class="sub" onclick="showCaptcha()">ë’¤ë¡œê°€ê¸°</button>
  `;
}

function showSeat(type){
  tryCount++;
  let total,open,rate;
  if(type==="F"){total=30;open=3;rate=0.0005}
  if(type==="1"){total=45;open=13;rate=0.03}
  if(type==="2"){total=60;open=35;rate=0.05}

  const openSet=new Set();
  while(openSet.size<open) openSet.add(rand(0,total));

  let html='<h2>ì¢Œì„ ì„ íƒ</h2><div class="seat-grid">';
  for(let i=0;i<total;i++){
    if(openSet.has(i)){
      html+=`<div class="seat ok" onclick="trySeat(this,${rate},'${type}')"></div>`;
    }else{
      html+=`<div class="seat block"></div>`;
    }
  }
  html+='</div><button class="sub" onclick="showZone()">ë’¤ë¡œê°€ê¸°</button>';
  main.innerHTML=html;
}

function trySeat(el,rate,type){
  if(Math.random()<rate){
    success(type);
  }else{
    el.className="seat block";
  }
}

function success(type){
  const time=((Date.now()-clickTime)/1000).toFixed(2);
  saveRank(time,waitNum,type,tryCount);
  main.innerHTML=`
    <h2>ğŸ‰ ì˜ˆë§¤ ì„±ê³µ</h2>
    <div>${time}ì´ˆ / ${waitNum}ë²ˆ / ${type}êµ¬ì—­</div><br>
    <button class="primary" onclick="showRanking()">ë­í‚¹ ë³´ê¸°</button><br>
    <button class="sub" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button>
  `;
}

function saveRank(t,w,z,c){
  const r=JSON.parse(localStorage.getItem("rank")||"[]");
  r.push({t,w,z,c});
  localStorage.setItem("rank",JSON.stringify(r));
}

function showRanking(){
  const r=JSON.parse(localStorage.getItem("rank")||"[]");
  let h='<h2>ğŸ† ë­í‚¹</h2>';
  r.sort((a,b)=>a.t-b.t).forEach(v=>{
    h+=`<div>${v.t}s / ${v.w}ë²ˆ / ${v.z} / ì‹œë„ ${v.c}</div>`;
  });
  h+='<br><button class="sub" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button>';
  document.getElementById("startScreen").classList.add("hidden");
  main.classList.remove("hidden");
  main.innerHTML=h;
}
</script>
</body>
</html>