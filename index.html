<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INTERPARK TICKETING SIM</title>
<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont;
  background: #f5f7fa;
  text-align: center;
}
h1 { color:#1a4cff; }
button {
  padding: 14px 20px;
  margin: 10px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
}
.blue { background:#1a4cff; color:white; }
.gray { background:#ccc; color:#666; }
.green { background:#7CFC98; }
.hidden { display:none; }

#bottom {
  position: fixed;
  bottom: 30px;
  width: 100%;
}

.grid {
  display: grid;
  grid-template-columns: repeat(6,1fr);
  gap: 6px;
  max-width: 320px;
  margin: auto;
}

.seat {
  width: 20px;
  height: 20px;
  margin: 3px;
  display: inline-block;
  border-radius: 4px;
}
</style>
</head>
<body>

<h1>INTERPARK</h1>

<div id="timer"></div>

<div id="bottom">
  <button class="blue" id="startBtn">시작하기</button>
  <button onclick="showRanking()">랭킹보기</button>
</div>

<div id="screen"></div>

<script>
let startTime, clickTime, waitNumber, tryCount=0, selectedZone;

const zoneLayout = [
 ["1","1","F","F","1","1"],
 ["1","1","F","F","1","1"],
 ["2","1","1","1","1","2"],
 ["2","1","1","1","1","2"],
 ["2","2","2","2","2","2"],
 ["2","2","2","2","2","2"]
];

document.getElementById("startBtn").onclick = startCountdown;

function startCountdown(){
  let t=5;
  document.getElementById("timer").innerText = "5";
  const c = setInterval(()=>{
    t--;
    document.getElementById("timer").innerText = t;
    if(t===0){
      clearInterval(c);
      clickTime = Date.now();
      waitNumber = 9000 + Math.floor(Math.random()*3000);
      showDate();
    }
  },1000);
}

function showDate(){
  document.getElementById("screen").innerHTML = `
    <h2>날짜 선택</h2>
    <button class="blue" onclick="showCaptcha()">2월 27일</button>
  `;
}

function showCaptcha(){
  const code = Array.from({length:6},()=>String.fromCharCode(65+Math.random()*26|0)).join("");
  window.captcha=code;
  document.getElementById("screen").innerHTML = `
    <h2>보안코드 입력</h2>
    <div>${code}</div>
    <input id="cap" maxlength="6">
    <br>
    <button class="blue" onclick="checkCap()">확인</button>
  `;
}

function checkCap(){
  if(document.getElementById("cap").value.toUpperCase()===window.captcha){
    showZone();
  }
}

function showZone(){
  let html='<h2>구역 선택</h2><div class="grid">';
  zoneLayout.flat().forEach(z=>{
    html+=`<button class="blue" onclick="seat('${z}')">${z}</button>`;
  });
  html+='</div>';
  document.getElementById("screen").innerHTML=html;
}

function seat(type){
  tryCount++;
  let total, open;
  if(type==="F"){ total=30; open=3; }
  if(type==="1"){ total=45; open=13; }
  if(type==="2"){ total=60; open=35; }

  let openSet = new Set();
  while(openSet.size<open){
    openSet.add(Math.floor(Math.random()*total));
  }

  let html='<h2>좌석 선택</h2>';
  for(let i=0;i<total;i++){
    if(openSet.has(i)){
      html+=`<div class="seat green" onclick="success('${type}')"></div>`;
    }else{
      html+=`<div class="seat gray"></div>`;
    }
  }
  document.getElementById("screen").innerHTML=html;
}

function success(zone){
  const time=((Date.now()-clickTime)/1000).toFixed(2);
  saveRank(time,waitNumber,zone,tryCount);
  alert(`예매 성공!\n${time}초\n${zone}구역`);
}

function saveRank(t,w,z,c){
  const r=JSON.parse(localStorage.getItem("rank")||"[]");
  r.push({t,w,z,c});
  localStorage.setItem("rank",JSON.stringify(r));
}

function showRanking(){
  const r=JSON.parse(localStorage.getItem("rank")||"[]");
  let html='<h2>랭킹</h2>';
  r.sort((a,b)=>a.t-b.t).forEach(v=>{
    html+=`<div>${v.t}s / ${v.w}번 / ${v.z} / 시도:${v.c}</div>`;
  });
  document.getElementById("screen").innerHTML=html;
}
</script>
</body>
</html>