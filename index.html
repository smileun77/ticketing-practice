<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INTERPARK SIM</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont;
  background:#f5f7fa;
  text-align:center;
}
h1{color:#1a4cff;margin-top:40px;}
.hidden{display:none;}

button{
  border:none;
  border-radius:8px;
  font-size:16px;
}
.primary{
  background:#1a4cff;
  color:white;
  width:90%;
  max-width:360px;
  padding:16px;
}
.sub{
  background:#eaeaea;
  width:90%;
  max-width:360px;
  padding:14px;
  margin-top:10px;
}

#startScreen{
  margin-top:80px;
}
#count{
  font-size:32px;
  margin-bottom:30px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:6px;
  max-width:320px;
  margin:20px auto;
}

.zoneBtn{
  padding:12px 0;
  background:#1a4cff;
  color:white;
}

.seat{
  width:14px;
  height:14px;
  border-radius:3px;
  margin:2px;
  display:inline-block;
}
.ok{background:#7CFC98;}
.block{background:#aaa;}

</style>
</head>

<body>

<h1>INTERPARK</h1>

<!-- ì‹œì‘ í™”ë©´ -->
<div id="startScreen">
  <div id="count"></div>
  <button id="startBtn" class="primary">ì‹œì‘í•˜ê¸°</button>
  <br>
  <button class="sub" onclick="showRanking()">ë­í‚¹ë³´ê¸°</button>
</div>

<!-- ë©”ì¸ í™”ë©´ -->
<div id="main" class="hidden"></div>

<script>
let startTime, clickTime, waitNum, tryCount=0, selectedZone;

const layout=[
["1","1","F","F","1","1"],
["1","1","F","F","1","1"],
["2","1","1","1","1","2"],
["2","1","1","1","1","2"],
["2","2","2","2","2","2"],
["2","2","2","2","2","2"]
];

// ì‹œì‘í•˜ê¸°
document.getElementById("startBtn").onclick=()=>{
  let t=5;
  const c=document.getElementById("count");
  c.innerText=t;
  const timer=setInterval(()=>{
    t--;
    c.innerText=t;
    if(t===0){
      clearInterval(timer);
      clickTime=Date.now();
      waitNum=calcWait();
      document.getElementById("startScreen").classList.add("hidden");
      document.getElementById("main").classList.remove("hidden");
      showCalendar();
    }
  },1000);
};

// ëŒ€ê¸°ìˆœë²ˆ ê³„ì‚°
function calcWait(){
  const diff=(Date.now()-clickTime)/1000;
  if(diff<0.2) return rand(7000,9000);
  if(diff<1) return rand(10000,18000);
  if(diff<2) return rand(25000,35000);
  return rand(40000,50000);
}
function rand(a,b){return Math.floor(Math.random()*(b-a))+a}

// ë‚ ì§œ ì„ íƒ
function showCalendar(){
  main.innerHTML=`
    <h2>ë‚ ì§œ ì„ íƒ</h2>
    <button class="primary" onclick="showTime('2026-02-27')">2ì›” 27ì¼</button><br><br>
    <button class="primary" onclick="showTime('2026-02-28')">2ì›” 28ì¼</button><br><br>
    <button class="primary" onclick="showTime('2026-03-01')">3ì›” 1ì¼</button>
  `;
}

// ì‹œê°„ ì„ íƒ
function showTime(d){
  main.innerHTML=`
    <h2>${d}</h2>
    <button class="primary" onclick="captcha()">ê³µì—° ì˜ˆë§¤</button>
  `;
}

// ë³´ì•ˆì½”ë“œ
function captcha(){
  const code=[...Array(6)].map(()=>String.fromCharCode(65+Math.random()*26|0)).join("");
  window.cap=code;
  main.innerHTML=`
    <h2>ë³´ì•ˆì½”ë“œ</h2>
    <div>${code}</div><br>
    <input id="c" maxlength="6"><br><br>
    <button class="primary" onclick="checkCap()">í™•ì¸</button>
  `;
}
function checkCap(){
  if(document.getElementById("c").value.toUpperCase()===cap) showZone();
}

// êµ¬ì—­ ì„ íƒ
function showZone(){
  let h='<h2>êµ¬ì—­ ì„ íƒ</h2><div class="grid">';
  layout.flat().forEach(z=>{
    h+=`<button class="zoneBtn" onclick="seat('${z}')">${z}</button>`;
  });
  h+='</div>';
  main.innerHTML=h;
}

// ì¢Œì„
function seat(type){
  tryCount++;
  let total,open,rate;
  if(type==="F"){total=30;open=3;rate=0.0005;}
  if(type==="1"){total=45;open=13;rate=0.03;}
  if(type==="2"){total=60;open=35;rate=0.05;}

  let openSet=new Set();
  while(openSet.size<open) openSet.add(rand(0,total));

  let h='<h2>ì¢Œì„ ì„ íƒ</h2>';
  for(let i=0;i<total;i++){
    if(openSet.has(i)){
      h+=`<div class="seat ok" onclick="attempt('${type}',this,${rate})"></div>`;
    }else{
      h+=`<div class="seat block"></div>`;
    }
  }
  main.innerHTML=h;
}

// ì¢Œì„ ì‹œë„
function attempt(z,el,rate){
  if(Math.random()<rate){
    success(z);
  }else{
    el.className="seat block";
  }
}

// ì„±ê³µ
function success(z){
  const time=((Date.now()-clickTime)/1000).toFixed(2);
  saveRank(time,waitNum,z,tryCount);
  showSuccess(time,z);
}

// ì„±ê³µ í™”ë©´
function showSuccess(t,z){
  main.innerHTML=`
    <h2>ğŸ‰ ì˜ˆë§¤ ì„±ê³µ</h2>
    <div>${t}ì´ˆ / ${waitNum}ë²ˆ / ${z}êµ¬ì—­</div><br>
    <button class="primary" onclick="showRanking()">ë­í‚¹ ë³´ê¸°</button><br><br>
    <button class="sub" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button>
  `;
}

// ë­í‚¹
function saveRank(t,w,z,c){
  const r=JSON.parse(localStorage.getItem("rank")||"[]");
  r.push({t,w,z,c});
  localStorage.setItem("rank",JSON.stringify(r));
}
function showRanking(){
  const r=JSON.parse(localStorage.getItem("rank")||"[]");
  let h='<h2>ğŸ† ë­í‚¹</h2>';
  r.sort((a,b)=>a.t-b.t).forEach(v=>{
    h+=`<div>${v.t}s / ${v.w}ë²ˆ / ${v.z} / ì‹œë„ ${v.c}</div>`;
  });
  h+='<br><button class="sub" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button>';
  main.innerHTML=h;
  document.getElementById("startScreen").classList.add("hidden");
  main.classList.remove("hidden");
}
</script>
</body>
</html>